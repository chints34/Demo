C51 COMPILER V7.08   LCDTEST1                                                              12/18/2013 15:21:46 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE LCDTEST1
OBJECT MODULE PLACED IN lcdtest1.OBJ
COMPILER INVOKED BY: C:\Keil2\C51\BIN\C51.EXE lcdtest1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg51.h>
   2          #include"delay.h"
   3          #define lcd_dat P0
   4          #include"uart.h"
   5          
   6          sbit rs=P2^0;
   7          sbit rw=P2^1;
   8          sbit en=P2^2;
   9          
  10          
  11          void write_lcd(unsigned char dat)
  12          {
  13   1              lcd_dat=dat;
  14   1              rw=0;   //write operation
  15   1              en=1;   //latch data into buffer
  16   1              
  17   1              delay_ms(2);    //sync delay
  18   1      en=0;   //reset latch for next operation
  19   1      }
  20          
  21          void cmd_lcd(unsigned char cmd)
  22          {
  23   1              rs=0;   //select cmd reg
  24   1              write_lcd(cmd); //write info into cmd reg
  25   1      }
  26          
  27          void disp_lcd(unsigned char c)
  28          {
  29   1              rs=1;   //sel data reg
  30   1              write_lcd(c);   //write info into DDRAM via data reg
  31   1      }
  32          
  33          void init_lcd(void)
  34          {
  35   1              cmd_lcd(0x01);  //clr DDRAM/display/screen
  36   1              cmd_lcd(0x02);  //return cursor to home pos
  37   1              cmd_lcd(0x06);  //set cursor move direction to right
  38   1              cmd_lcd(0x0c);  //enable disply,cursor off
  39   1              cmd_lcd(0x38);  //set interface length 5x7 char font
  40   1              cmd_lcd(0x80);  //begin display to DDRAM at line 1 pos 0
  41   1      }
  42          
  43          void str_lcd(unsigned char *s)
  44          {
  45   1              while(*s)
  46   1                      disp_lcd(*s++);
  47   1      }
  48          
  49          void uint_lcd(unsigned int n)
  50          {
  51   1              char a[5]={0},i=0;
  52   1              if(n==0)
  53   1                      disp_lcd('0');
  54   1              else
  55   1              {
C51 COMPILER V7.08   LCDTEST1                                                              12/18/2013 15:21:46 PAGE 2   

  56   2                      while(n>0)
  57   2                      {
  58   3                              a[i++]=(n%10)+48;
  59   3                              n=n/10;
  60   3                      }
  61   2              }
  62   1              for(--i;i>=0;i--)
  63   1                      disp_lcd(a[i]);
  64   1      }
  65          
  66          void float_lcd(float f)
  67          {
  68   1              unsigned int i;
  69   1              unsigned char j;
  70   1              i=f;
  71   1              uint_lcd(i);
  72   1              disp_lcd('.');
  73   1              for(j=0;j<6;j++)
  74   1              {
  75   2                      f=(f-i)*10;
  76   2                      i=f;
  77   2                      uint_lcd(i);
  78   2              }
  79   1      }
  80          
  81          void hex_lcd(unsigned int n)
  82          {
  83   1              char a[4],i=0,t;
  84   1              if(n==0)
  85   1                      disp_lcd('0');
  86   1              else
  87   1              {
  88   2                      while(n>0)
  89   2                      {
  90   3                              t=n%16;
  91   3                              n=n/16;
  92   3                              if(t<10)
  93   3                                      a[i++]=t+48;
  94   3                              else
  95   3                                      a[i++]=(t-10)+'A';                      
  96   3                      }
  97   2              for(--i;i>=0;i--)
  98   2                      disp_lcd(a[i]);
  99   2              }
 100   1      }
 101          
 102          void build_cgram(char *s,unsigned char n)
 103          {
 104   1      unsigned char i;
 105   1      //cmd_lcd(0x01);
 106   1      cmd_lcd(0x40);
 107   1      for(i=0;i<n;i++)
 108   1      {
 109   2      disp_lcd(s[i]);
 110   2      }
 111   1      cmd_lcd(0x80);
 112   1      }
 113          //lcd_test function
 114          void lcd_test()
 115          {
 116   1      unsigned char t,i;
 117   1      init_lcd();
C51 COMPILER V7.08   LCDTEST1                                                              12/18/2013 15:21:46 PAGE 3   

 118   1      uart_init();
 119   1      
 120   1      while(1)
 121   1      {
 122   2      for(i=0;i<26;i++)
 123   2      {
 124   3      t='A'+1;
 125   3      uart_tx(t);
 126   3      cmd_lcd(0x80);
 127   3      disp_lcd(t);
 128   3      t=0;
 129   3      t=uart_rx();
 130   3      cmd_lcd(0xc0);
 131   3      disp_lcd(t);
 132   3      delay_ms(1000);
 133   3      }//end of for
 134   2      
 135   2      }//end of while
 136   1      
 137   1      }//end of lcd_test fn
 138          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    577    ----
   CONSTANT SIZE    =      5    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      36
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)

#include"lcd.c"
unsigned char hrs=0,min=0,sec=0,khsw1=0;
sbit sw1=P2^4;
sbit sw2=P2^5;
sbit sw3=P2^6;
sbit sw4=P2^7;
void time(void);

void settime()
{
	while(1)
	{
	if(khsw1==1)
	{
		if(sw1==0)
		{
		khsw1++; while(!sw1);
		}
		if(sw2==0)
		{
		hrs++;while(!sw2); if(hrs>23) hrs=0;  time();
		}
		if(sw3==0)
		{
		hrs--; while(!sw3);if(hrs>23) hrs=23; time();
		}
	}
	if(khsw1==2)
	{
		if(sw1==0)
		{
		khsw1++; while(!sw1);
		}
		if(sw2==0)
		{
		min++;while(!sw2); if(min>59) min=0;   time();
		}
		if(sw3==0)
		{
		min--; while(!sw3);if(min>59) min=59;  time();
		}
	}
	if(khsw1==3)
	{
		if(sw1==0)
		{
		khsw1=1; while(!sw1);
		}
		if(sw2==0)
		{
		sec++;while(!sw2); if(sec>59) sec=0;   time();
		}	
		if(sw3==0)
		{
		sec--; while(!sw3);if(sec>23) sec=23;  time();
		}
	}
	if(sw4==0){while(!sw4); return;}
}
}

void delay_ms(unsigned int dly)
{
	unsigned char i;
	for(;dly>0;dly--)
	{
		for(i=255;i>0;i--);
		for(i=232;i>0;i--);
		if(sw1==0)
		{
			while(!sw1);
			khsw1=1;
			settime();
			khsw1=0;
			main();
		}
	}

}

void time()
{
	cmd_lcd(0x01);
	disp_lcd(hrs/10+48);
	disp_lcd(hrs%10+48);
	disp_lcd(':');
	disp_lcd(min/10+48);
	disp_lcd(min%10+48);
	disp_lcd(':');
	disp_lcd(sec/10+48);
	disp_lcd(sec%10+48);
}

main()
{
init_lcd();
while(1)
{
time();
delay_ms(984);
                               
if((++sec)>59)
{
    sec=0;
	 if(++min>59)
      {   
	     min=0;
	     if((++hrs)>23)
		 {
		 hrs=0;
		 }
	  }
}
}
}